# 玩法文档 - Wooden Blocks (木块拼图)

**游戏名称:** Wooden Blocks (木块拼图)

**开发需求描述 - 核心玩法**

**1. 游戏目标:**
玩家的目标是在一个 9x9 的网格上放置不同形状的木块，通过消除整行、整列或指定的 3x3 方块区域来获得尽可能高的分数。

**2. 游戏棋盘:**
*   **结构:** 实现一个 9x9 的正方形网格 (共 81 个单元格) 作为游戏区域。
*   **子区域:** 网格内部在视觉和逻辑上划分出 9 个固定的 3x3 子区域 (九宫格)。

**3. 方块:**
*   **形状库:** 游戏包含以下 **XX** 种固定形状的木块 (具体形状待定，建议包含但不限于)：
    *   **基础:** 1x1, 1x2, 1x3, 1x4, 1x5 (条形)
    *   **方形:** 2x2, 3x3
    *   **L形:** 标准L (3格高), 大L (4格高), 以及它们的镜像
    *   **T形:** 标准T形
    *   **Z/S形:** 标准Z/S形及其镜像
    *   **U形:** 5格U形
    *   **十字形:** 5格十字形
    *   *开发者注: 需要为每种形状定义精确的单元格相对坐标。例如，一个 2x2 方块可以定义为 [(0,0), (1,0), (0,1), (1,1)]。*
*   **方块供应:**
    *   游戏每次向玩家提供 **3** 个从“形状库”中随机选择的方块。
    *   **生成机制:** 采用 **"Shuffle Bag"** 机制：
        1.  将“形状库”中所有 **XX** 种形状放入一个虚拟“袋子”。
        2.  随机从袋子中抽取 3 个方块给玩家。
        3.  当袋子中的方块被抽完后，将所有 **XX** 种形状重新放入袋子并洗牌，然后继续抽取。
        *此机制确保了形状出现的相对均衡性。*
    *   **注意:** 不进行“可放置性预检查”。即使生成的 3 个方块都无法放置，也照常提供给玩家，这是游戏结束的判断依据之一。

**4. 核心操作与放置:**
*   **选择与放置:** 玩家通过 **拖拽 (Drag and Drop)** 操作，从当前提供的 3 个方块中选择一个，并将其放置到 9x9 网格的 **空白** 单元格上。
*   **放置有效性:**
    *   系统实时检查：拖拽位置是否 **完全** 在 9x9 网格范围内。
    *   系统实时检查：目标区域的所有单元格是否都 **为空白**。
*   **放置反馈:**
    *   提供清晰的 **视觉预览 (Ghost/Preview)**，显示方块在当前鼠标/触摸位置如果放置后的形态。
    *   预览效果应明确指示当前位置 **是否可以合法放置** (例如，通过颜色变化：绿色表示可放，红色表示不可放)。
    *   只允许在 **合法** 位置释放鼠标/触摸来完成放置。
*   **方块消耗与补充:**
    *   成功放置一个方块后，该方块从当前 3 个可选方块中 **移除**。
    *   当 3 个可选方块 **全部** 放置完毕后，系统 **立即** 从“袋子”中抽取生成一组新的 3 个随机方块。

**5. 消除机制 (核心差异点):**
*   **触发条件:** 在一个方块成功放置 **之后**，检查是否满足以下消除条件：
    *   **行消除:** 网格中的任意 **一整行** (水平 9 个单元格) 被方块完全填满。
    *   **列消除:** 网格中的任意 **一整列** (垂直 9 个单元格) 被方块完全填满。
    *   **方块区域消除:** 网格中预定义的 9 个 **3x3 子区域** 中的任意一个被方块完全填满 (该区域内 9 个单元格都被占据)。
*   **消除效果:**
    *   所有被填满的行、列、或 3x3 区域内的方块 **同时被消除**。
    *   被消除区域的单元格恢复为 **空白** 状态。
*   **同时消除:** 单次放置操作 **可能** 同时触发多个行、列和/或 3x3 方块区域的消除。

**6. 计分系统:**
*   **放置得分:** 每成功放置一个方块，获得等同于该方块所含 **单元格数量** 的分数 (例如，放置一个 5 格方块得 5 分)。
*   **消除得分 (基础):**
    *   每消除 **一整行**，获得 **18 分**。
    *   每消除 **一整列**，获得 **18 分**。
    *   每消除 **一个 3x3 区域**，获得 **18 分**。
*   **多重消除奖励 (Combo):** 如果一次放置 **同时** 触发了 N 项消除 (N > 1，项指行、列、区域)，则该次消除的总得分应用 **乘数** 加成：
    *   消除 1 项 (N=1): 基础分 (18分) * 1 = **18 分**
    *   消除 2 项 (N=2): 基础分 (18*2=36分) * 1.5 = **54 分**
    *   消除 3 项 (N=3): 基础分 (18*3=54分) * 2.0 = **108 分**
    *   消除 4 项 (N=4): 基础分 (18*4=72分) * 2.5 = **180 分**
    *   消除 5 项 (N=5): 基础分 (18*5=90分) * 3.0 = **270 分**
    *   *以此类推，每多消除一项，乘数增加 0.5*
*   **连续消除奖励 (Streak):** 系统追踪玩家 **连续** 多少次“放置方块的操作”**都**触发了至少一次消除 (行、列或区域)。每次成功的连续消除，会在 **当次操作的总得分 (放置分 + Combo消除分)** 基础上，额外增加 **固定奖励分**：
    *   第 1 次触发消除 (Streak 1): + **0** 额外分
    *   连续第 2 次触发消除 (Streak 2): + **10** 额外分
    *   连续第 3 次触发消除 (Streak 3): + **25** 额外分
    *   连续第 4 次触发消除 (Streak 4): + **45** 额外分
    *   连续第 5 次及以后触发消除 (Streak 5+): + **70** 额外分
    *   **Streak 重置:** 如果玩家某次放置方块的操作 **没有触发任何消除**，则 Streak 计数 **重置为 0**。
*   **分数显示:** 游戏界面需要 **实时** 显示玩家当前的总得分。

**7. 游戏结束条件:**
*   当玩家当前持有的 3 个可选方块中，**没有任何一个** 方块能够被合法地放置到网格上 **剩余的任何空白位置** 时，游戏结束。
    *   *判断逻辑：遍历当前 3 个方块，对每个方块尝试网格上所有可能的放置位置，如果没有任何一个方块能在任何一个位置合法放置，则游戏结束。*

**8. 最高分记录:**
*   系统需要 **本地存储** 并能够在游戏结束界面或主菜单 **显示** 玩家的历史最高分。

**9. 控制方式:**
*   **主要:** 拖放 (Drag and Drop)。
